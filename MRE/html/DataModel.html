<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MeshRusExt: Data model class hierarchy</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="CustomStyle.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="MRIcon.ico"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MeshRusExt
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('DataModel.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Data model class hierarchy </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>All data in MeshRUs are stored in objects. Each object can have it own type derived from <a class="el" href="classMR_1_1Object.html">Object</a>: </p><pre class="fragment">           Object (Simple object can be selected or hidden)
             |
        VisualObject (Object with common visualize properties, which are used in ObjectMesh and ObjectPoints)
         /        \
  ObjectMesh     ObjectPoints
      /
JawScan, Tooth, ...
</pre> <h1><a class="anchor" id="DataModelScene"></a>
Scene</h1>
<p>Scene in MeshRUs consists of a tree of object with one root, and all others objects are children or some grandchildren of scene root. Each object has its own name (e.g. Upper Jaw), transform, visibility, selected and ancillary flags. Ancillary objects are not shown in UI list but rendered in 3D and cannot be selected. For example, a scene can look like: </p><pre class="fragment">                Root
                 |
                Case
                 |
               Mouth
              /     \
      Upper Jaw     Lower Jaw
        /      \
    Jaw Scan   Tooth UL1 ...
</pre><p> Objects inherit parameters from scene parent, for example transform and visibility. So all children are hidden if their parent is hidden irrespective of their own visibility field. And each object transform is the transform from local object space into parent's space. So if parent is moved, all objects are moved with it.</p>
<h1><a class="anchor" id="DataModelSerialization"></a>
Serialization</h1>
<p>To serialize object tree one needs to call </p><div class="fragment"><div class="line"><span class="comment">// saves object subtree in given scene file (zip/mru)</span></div>
<div class="line"><span class="comment">// format specification:</span></div>
<div class="line"><span class="comment">//  children are saved under folder with name of their parent object</span></div>
<div class="line"><span class="comment">//  all objects parameters are saved in one JSON file in the root folder</span></div>
<div class="line"><span class="comment">//  </span></div>
<div class="line"><span class="comment">// saving is controlled with Object::serializeModel_ and Object::serializeFields_</span></div>
<div class="line"><a class="code" href="MRMeshFwd_8h.html#a08ff09fd7e75c029b08cc255b0734300">MRMESH_API</a> tl::expected&lt;void, std::string&gt; <a class="code" href="namespaceMR.html#aa844f4c2822362ef9839cf2c13e77a45">serializeObjectTree</a>( <span class="keyword">const</span> Object&amp; <span class="keywordtype">object</span>, </div>
<div class="line">    <span class="keyword">const</span> std::filesystem::path&amp; path, <a class="code" href="namespaceMR.html#a51ff94746a41880cd06d3272b5bcf710">ProgressCallback</a> progress = {} );</div>
<div class="ttc" id="aMRMeshFwd_8h_html_a08ff09fd7e75c029b08cc255b0734300"><div class="ttname"><a href="MRMeshFwd_8h.html#a08ff09fd7e75c029b08cc255b0734300">MRMESH_API</a></div><div class="ttdeci">#define MRMESH_API</div><div class="ttdef"><b>Definition:</b> MRMeshFwd.h:14</div></div>
<div class="ttc" id="anamespaceMR_html_a51ff94746a41880cd06d3272b5bcf710"><div class="ttname"><a href="namespaceMR.html#a51ff94746a41880cd06d3272b5bcf710">MR::ProgressCallback</a></div><div class="ttdeci">std::function&lt; bool(float)&gt; ProgressCallback</div><div class="ttdef"><b>Definition:</b> MRProgressCallback.h:7</div></div>
<div class="ttc" id="anamespaceMR_html_aa844f4c2822362ef9839cf2c13e77a45"><div class="ttname"><a href="namespaceMR.html#aa844f4c2822362ef9839cf2c13e77a45">MR::serializeObjectTree</a></div><div class="ttdeci">MRMESH_API tl::expected&lt; void, std::string &gt; serializeObjectTree(const Object &amp;object, const std::filesystem::path &amp;path, ProgressCallback progress={}, SceneFolderCallback preCompress={})</div></div>
</div><!-- fragment --><p>And to deserialize object tree: </p><div class="fragment"><div class="line"><span class="comment">// loads objects tree from given scene file (zip/mru)</span></div>
<div class="line"><span class="comment">// format specification:</span></div>
<div class="line"><span class="comment">//  children are saved under folder with name of their parent object</span></div>
<div class="line"><span class="comment">//  all objects parameters are saved in one JSON file in the root folder</span></div>
<div class="line"><span class="comment">//  </span></div>
<div class="line"><span class="comment">// loading is controlled with Object::deserializeModel_ and Object::deserializeFields_</span></div>
<div class="line"><a class="code" href="MRMeshFwd_8h.html#a08ff09fd7e75c029b08cc255b0734300">MRMESH_API</a> tl::expected&lt;Object, std::string&gt; <a class="code" href="namespaceMR.html#ac8b043af7b6c494400e5e1dd16048ee1">deserializeObjectTree</a>(<span class="keyword">const</span> std::filesystem::path&amp; path);</div>
<div class="ttc" id="anamespaceMR_html_ac8b043af7b6c494400e5e1dd16048ee1"><div class="ttname"><a href="namespaceMR.html#ac8b043af7b6c494400e5e1dd16048ee1">MR::deserializeObjectTree</a></div><div class="ttdeci">MRMESH_API tl::expected&lt; std::shared_ptr&lt; Object &gt;, std::string &gt; deserializeObjectTree(const std::filesystem::path &amp;path, SceneFolderCallback postDecompress={})</div></div>
</div><!-- fragment --><h1><a class="anchor" id="DataModelInheritance"></a>
Inheritance</h1>
<p>To create your own object type you need to make class derived from one of base class:</p><ol type="1">
<li>If you need object with mesh and some extra methods and fields you should derive from <a class="el" href="classMR_1_1ObjectMesh.html">ObjectMesh</a></li>
<li>If you need object with voxels and some extra methods and fields you should derive from <a class="el" href="classMR_1_1ObjectVoxels.html">ObjectVoxels</a></li>
<li>If you need object that has no visual representation you should derive from <a class="el" href="classMR_1_1Object.html">Object</a></li>
<li>If you need object that has visual representation different from mesh or voxels you should derive from <a class="el" href="classMR_1_1VisualObject.html">VisualObject</a> but a support in <a class="el" href="classMR_1_1Viewer.html">Viewer</a> of this new type might not be present yet.</li>
</ol>
<p>To be able to use serialization and deserialization you have to do:</p><ol type="1">
<li>Register new data model unit in class factory by adding <div class="fragment"><div class="line"><a class="code" href="MRObjectFactory_8h.html#a9f975a26b39f4d3adee23c7ab3014dce">ADD_CLASS_FACTORY</a>( MyCustomObject );</div>
<div class="ttc" id="aMRObjectFactory_8h_html_a9f975a26b39f4d3adee23c7ab3014dce"><div class="ttname"><a href="MRObjectFactory_8h.html#a9f975a26b39f4d3adee23c7ab3014dce">ADD_CLASS_FACTORY</a></div><div class="ttdeci">#define ADD_CLASS_FACTORY(className)</div><div class="ttdef"><b>Definition:</b> MRObjectFactory.h:14</div></div>
</div><!-- fragment --></li>
<li>Override following functions <div class="fragment"><div class="line"><span class="comment">// Creates future to save object model (e.g. mesh) in given file</span></div>
<div class="line"><a class="code" href="MRMeshFwd_8h.html#a08ff09fd7e75c029b08cc255b0734300">MRMESH_API</a> <span class="keyword">virtual</span> tl::expected&lt;std::future&lt;void&gt;, std::string&gt; serializeModel_( <span class="keyword">const</span> std::filesystem::path&amp; path ) <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Write parameters to given Json::Value,</span></div>
<div class="line"><span class="comment">// if you override this method, please call Base::serializeFields_(root) in the beginning</span></div>
<div class="line"><a class="code" href="MRMeshFwd_8h.html#a08ff09fd7e75c029b08cc255b0734300">MRMESH_API</a> <span class="keyword">virtual</span> <span class="keywordtype">void</span> serializeFields_( Json::Value&amp; root ) <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Reads model from file</span></div>
<div class="line"><a class="code" href="MRMeshFwd_8h.html#a08ff09fd7e75c029b08cc255b0734300">MRMESH_API</a> <span class="keyword">virtual</span> tl::expected&lt;void, std::string&gt; deserializeModel_( <span class="keyword">const</span> std::filesystem::path&amp; path );</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Reads parameters from json value</span></div>
<div class="line"><span class="comment">// if you override this method, please call Base::deserializeFields_(root) in the beginning</span></div>
<div class="line"><a class="code" href="MRMeshFwd_8h.html#a08ff09fd7e75c029b08cc255b0734300">MRMESH_API</a> <span class="keyword">virtual</span> <span class="keywordtype">void</span> deserializeFields_( <span class="keyword">const</span> Json::Value&amp; root );</div>
</div><!-- fragment --> </li>
</ol>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
